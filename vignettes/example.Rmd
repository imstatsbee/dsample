---
title: "example"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{example}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: references.bib
nocite: | 
    @Wang2014, @Wang2007, @Lunn2000, @West1993, @Liang2007
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", fig.width=8, fig.height=8
)
```

```{r setup}
library(dsample)
```

## Mixture Model

Run `demo(mix2)` and `demo(mix3)`. 

## 6.1 Space Shuttle Challenger disaster 

Data are taken from @Dalal1989. Details are described in @Dezfuli2009 on [pages 144--146](https://ntrs.nasa.gov/api/citations/20090023159/downloads/20090023159.pdf).

```{r eval=FALSE}
rm(list=ls())
failure <- c( 1, 1, 1,  1, 0, 0, 0,  0, 0, 0, 0,  0, 1, 1, 0,  0, 0, 1, 0,  0, 0, 0, 0)
temp <- c( 53, 57, 58, 63, 66, 67, 67, 67, 68, 69, 70, 70, 70, 70, 72, 73, 75, 75, 76, 76, 78, 79, 81)
data <- data.frame(temp=temp, failure=failure)
n.obs <- nrow(data);
fit <- glm(failure~temp, family=binomial(link="logit"));
alpha.hat <- fit$coef[1]
gamma <- 0.577216
b <- exp(alpha.hat + gamma)

expr <- str2expression("lp <- 0;
  for( index in 1:n.obs) lp <- lp + failure[index] * log(exp(alpha+beta*temp[index])/(1+exp(alpha+beta*temp[index]))); 
  for( index in 1:n.obs) lp <- lp + (1-failure[index])*log(1/(1+exp(alpha+beta*temp[index])));
  lp <- lp + alpha - exp(alpha)/b;")
sets <- list(alpha=runif(1e5), beta=runif(1e5))
smp <- dsample(expr=expr, rpmat=sets, nk=1e4, n=1e3)

library(dsample)
expr <- str2expression("(x1*(1-x2))^5 * (x2*(1-x1))^3 * (1-x1*(1-x2)-x2*(1-x1))^37")
# expr <- expression((x1*(1-x2))^5 * (x2*(1-x1))^3 * (1-x1*(1-x2)-x2*(1-x1))^37)
sets <- list(x1=runif(1e5), x2=runif(1e5))
smp <- dsample(expr=expr, rpmat=sets, nk=1e4, n=1e3)
op <- summary(smp, n=10, k=2)
op$means
op$modes
do.call(cbind, lapply(split(op$X, op$grp), colMeans))
plot(op, which=2)
```

## 6.2 Beetle

Data are taken from @Prentice1976. Details are described in [OpenBUGS Examples Vol 2. Beetles](https://chjackson.github.io/openbugsdoc/Examples/Beetles.html).

```{r eval=FALSE}
wi <- c(1.6907, 1.7242, 1.7552, 1.7842, 1.8113, 1.8369, 1.8610, 1.8839)
yi <- c(6, 13, 18, 28, 52, 53, 61, 60)
ni <- c(59, 60, 62, 56, 63, 59, 62, 60)
data <- data.frame(wi=wi, yi=yi, ni=ni)
data
```


## 6.3 Dugongs

Data are taken from @Ratkowsky1986. Details are described in [OpenBUGS Examples Vol 2.Dugongs](https://chjackson.github.io/openbugsdoc/Examples/Dugongs.html).

```{r eval=FALSE}
x.age <- c( 1.0, 1.5, 1.5, 1.5, 2.5, 4.0, 5.0, 5.0, 7.0, 8.0, 8.5, 9.0, 9.5, 9.5, 10.0, 12.0, 12.0, 13.0, 13.0, 14.5, 15.5, 15.5, 16.5, 17.0, 22.5, 29.0, 31.5);
y.length <- c(1.80, 1.85, 1.87, 1.77, 2.02, 2.27, 2.15, 2.26, 2.35, 2.47, 2.19, 2.26, 2.40, 2.39, 2.41, 2.50, 2.32, 2.43, 2.47, 2.56, 2.65, 2.47, 2.64, 2.56, 2.70, 2.72, 2.57);
data <- data.frame(x.age=x.age, y.length=y.length);
```

## 6.4 British Coal Mining Data 

Data are taken from @Diggle1988. This is not an example from WinBUGS. 

```{r eval=FALSE}
x <- c(4, 5, 4, 1, 0, 4, 3, 4, 0, 6, 3, 3, 4, 0, 2, 6, 3, 3, 5, 4, 5, 3, 1, 4, 4, 1, 5, 5, 3, 4, 2, 5, 2, 2, 3, 4, 2, 1, 3, 2, 2, 1, 1, 1, 1, 3, 0, 0, 1, 0, 1, 1, 0, 0, 3, 1, 0, 3, 2, 2, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 2, 1, 0, 0, 0, 1, 1, 0, 2, 3, 3, 1, 1, 2, 1, 1, 1, 1, 2, 4, 2, 0, 0, 0, 1, 4, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1);
```


## 6.5 Nuclear Pump Data 

Data are taken from @Gaver1987. Details are described in [OpenBUGS Examples Vol 2.](https://chjackson.github.io/openbugsdoc/Examples/Pumps.html).

```{r eval=FALSE}
time <- c(94.32, 15.72, 62.88, 125.76, 5.24, 31.44, 1.05, 1.05, 2.10, 10.48)
failure <- c( 5, 1, 5, 14, 3, 19, 1, 1, 4, 22)
data <- data.frame(time=time, failure=failure)

pump
```



## References 

